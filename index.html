---
layout: default
---
  <main class = "mdl-layout__content mdl-color-text--primary">
    <div class="mdl-grid">
      <div class="mdl-cell mdl-cell--12-col mdl-cell--8-col-tablet mdl-cell--4-col-phone" style="text-align: center">
        <h4 class="mdl-layout__title" id="plan_description"">
          {% assign plan = site.data.main['plans']['oyb_nlt'] %}{{plan.plan_description}}
        </h4>
        <h6 class="mdl-layout__headline" id="readings"></h6>
        <p>Reading selector: <input type="date" id="datepicker"></p>
      </div>
      <div class="mdl-cell mdl-cell--12-col mdl-cell--8-col-tablet mdl-cell--4-col-phone">
        <div class="mdl-card mdl-shadow--3dp">
          <div class="mdl-card__supporting-text">
            <h4 id="audio_description">
              {% assign plan = site.data.main['plans']['oyb_nlt'] %}{{plan.audio_description}}
            </h4>
          </div>
          <audio id="audio_refresh" width='90%' height='25px' autoplay="false" controls="true" name="media">
              <source id="audio_url" type="audio/mp3">
          </audio>
        </div>
      </div>
      <div class="mdl-cell mdl-cell--12-col mdl-cell--8-col-tablet mdl-cell--hide-phone">
          <div class="mdl-card mdl-shadow--3dp object-container">
            <object id="bg_readings_desktop" type="text/html" class="object-embed">
            </object>
          </div>
      </div>
      <div class="mdl-cell mdl-cell--4-col-phone mdl-cell--hide-desktop mdl-cell--hide-tablet">
          <div class="mdl-card mdl-shadow--3dp">
            <div class="mdl-card__supporting-text">
              <h4>Bible Passages</h4>
            </div>
            <object id="bg_readings_phone" type="text/html" width="100%" height="10000px">
            </object>
          </div>
      </div>
  </main>
  <script type="text/javascript">

    // Get Day of Year
    Date.prototype.getDOY = function() {
      var dayCount = [0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334];
      var mn = this.getMonth();
      var dn = this.getDate();
      var dayOfYear = dayCount[mn] + dn;
      return dayOfYear;
    };

    // Retrieve variables from file and update DOM
    populateReadingByDay = function(day, data) {
      // Get data that corresponds to current value of day
      console.log(`Day is ${day}`)
      let day_reading_data = data.days[day];

      // Get list of Scriptures that corresponds to current value of day
      let readings = day_reading_data["oyb"]["readings"];
      // Update UI
      document.getElementById('readings').innerHTML = `Day ${day}: ${readings.join(', ')}`;

      // Build Bible Gateway URL
      let base_url = 'https://www.biblegateway.com/passage/?search={var1}&version=NLT&interface=print';
      let bg_url = base_url.replace('{var1}', readings.join('%3B').replace(':', '%3A').split(' ').join(''))

      // encode URL
      //bg_url = encodeURI(bg_url);
      console.log(`url ${bg_url}`)
      // update UI
      document.getElementById('bg_readings_desktop').data = bg_url;
      document.getElementById('bg_readings_phone').data = bg_url;

      // Get url part that corresponds to current value of day
      let url = data.plans.oyb_nlt.url;
      // Create complete URL
      url = url.replace("{var1}", day_reading_data["oyb"]["audio"]["nlt"]);
      console.log(`Daily reading url: ${url}`)
      // Update UI
      document.getElementById('audio_url').src = url;
      document.getElementById('audio_refresh').load();
    };
    
    $( document ).ready(function() {
      // Get main json from file; convert from Ruby hash to json object
      let data = {{site.data.main | jsonify}}
      // Get day
      let day = new Date().getDOY();
      console.log(day);
      populateReadingByDay(day, data);

      $("input").on("change", function () {
        var str = $(this).val()
        var year = str.substring(0, 4);
        var month = str.substring(5, 7);
        var day = str.substring(8, 10);
        var myDate = new Date(`${month}/${day}/${year}`);
        console.log(`Day selected: ${myDate}`)
        populateReadingByDay(myDate.getDOY(), data);
      });
    });
  </script>